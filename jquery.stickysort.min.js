!function(t){t.fn.stickySort=function(e){var s=t.extend(!0,{threshold:{rows:3,viewport:.25,px:!1,allowanceEval:"min"},sortable:!1,scrollThrottle:15,resizeThrottle:250},e);return this.each(function(){if(t(this).is("table")&&t(this).find("thead").length>0&&t(this).find("th").length>0){var e=t(window),a=t(this),o=a.find("thead").clone(),i=a.find("thead, tbody").clone();a.wrap('<div class="sticky-wrap" />').parent().addClass(a.attr("class")).end().addClass("sticky-enabled"),a.hasClass("overflow-y")&&a.removeClass("overflow-y").parent().addClass("overflow-y"),a.after('<div class="sticky-thead"><table /></div>'),a.find("tbody th").length>0&&a.after('<div class="sticky-col"><table /></div><div class="sticky-intersect"><table /></div>');var d=t(this).siblings(".sticky-thead"),r=t(this).siblings(".sticky-col"),l=t(this).siblings(".sticky-intersect"),n=t(this).parent(".sticky-wrap");d.find("table").append(o),r.find("table").append(i).find("thead th:gt(0)").remove().end().find("tbody td").remove(),l.find("table").html("<thead><tr><th>"+a.find("thead th:first-child").html()+"</th></tr></thead>");var h=function(){a.find("thead th").each(function(e){d.find("th").eq(e).width(t(this).width())}).end().find("tr").each(function(e){r.find("tr").eq(e).height(t(this).height())}),d.width(n.width()).find("table").width(a.width()),r.find("th").add(l.find("th")).width(a.find("thead th").first().width())},c=function(){var t=f();if(a.height()>n.height())n.scrollTop()>0?(d.add(l).css({opacity:1,"pointer-events":"auto",position:"fixed",top:n.offset().top-e.scrollTop(),left:n.offset().left}),d.find("table").css({left:-n.scrollLeft()})):(d.add(l).css({opacity:0,"pointer-events":"none"}),l.css({position:"absolute",top:0,left:0}));else{var s=50;e.scrollTop()>a.offset().top-s&&e.scrollTop()<a.offset().top+a.outerHeight()-t?(d.add(l).css({opacity:1,"pointer-events":"auto",position:"fixed",left:n.offset().left,top:s}),d.find("table").css({left:-n.scrollLeft()})):(d.css({top:0}),d.add(l).css({opacity:0,"pointer-events":"none",position:"absolute",left:n.scrollLeft(),top:0}))}n.scrollLeft()>0?r.css({position:"fixed",left:n.offset().left,top:n.offset().top-e.scrollTop(),height:n.height()}).find("table").css({top:-n.scrollTop(),left:0}).end().add(l).css({opacity:1,"pointer-events":"auto",width:r.width()}):r.css({opacity:0,"pointer-events":"none"})},f=function(){var o=0,i=[];return a.find("tbody tr:lt("+s.threshold.rows+")").each(function(){o+=t(this).height()}),i.push(o),i.push(e.height()*s.threshold.viewport),s.threshold.px&&i.push(s.threshold.px),"min"==s.threshold.allowanceEval?Math.min.apply(null,i):Math.max.apply(null,i)};(s.sortable||void 0!=a.data("sortable")||a.hasClass("sortable"))&&(a.find("tbody tr").each(function(e){t(this).attr("data-sortOrder",e)}),n.addClass("sortable").find("thead th").css({height:o.height()}).addClass("sort-default").data("sortState",1).wrapInner('<div class="sa-stickysort" />').find(".sa-stickysort").css({position:"relative"}).append('<a href="#" class="sort-handle"></a>').find(".sort-handle").click(function(t){t.preventDefault()}),n.on("click",".sticky-enabled thead th, .sticky-thead thead th, .sticky-col thead th, .sticky-intersect thead th",function(){var e=t(this),s=e.index(),o=n.find("thead th").eq(s),i=t.makeArray(a.find("tbody tr"));e.data("sortState")%3==0?(i.sort(function(e,s){return parseInt(t(e).attr("data-sortOrder"))-parseInt(t(s).attr("data-sortOrder"))}),e.add(o).removeClass("sort-asc").removeClass("sort-desc").addClass("sort-default")):(i.sort(function(e,a){function o(t){for(var e,s,a=[],o=0,i=-1,d=0;e=(s=t.charAt(o++)).charCodeAt(0);){var r=46==e||e>=48&&57>=e;r!==d&&(a[++i]="",d=r),a[i]+=s}return a}var i=o(t(e).children().eq(s).text()),d=o(t(a).children().eq(s).text());for(x=0;i[x]&&d[x];x++)if(i[x]!==d[x]){var r=Number(i[x]),l=Number(d[x]);return r==i[x]&&l==d[x]?r-l:i[x]>d[x]?1:-1}return i.length-d.length}),e.data("sortState")%3==2?(i=i.reverse(),e.add(o).removeClass("sort-default").removeClass("sort-asc").addClass("sort-desc")):e.add(o).removeClass("sort-default").removeClass("sort-desc").addClass("sort-asc"));var d=e.data("sortState")+1;e.add(o).data("sortState",d%3),n.find("table").each(function(){t(this).find("thead th").not(":eq("+s+")").data("sortState",1).removeClass("sort-asc").removeClass("sort-desc").addClass("sort-default")}),a.find("tbody").html(i),a.find("tbody tr").each(function(e){r.find("tbody tr").eq(e).find("th").html(t(this).find("th").first().html())})})),h(),a.parent(".sticky-wrap").scroll(t.throttle(s.scrollThrottle,c)),e.load(h).resize(t.debounce(s.resizeThrottle,function(){h(),c()})).scroll(t.throttle(s.scrollThrottle,c))}}),this}}(jQuery);
